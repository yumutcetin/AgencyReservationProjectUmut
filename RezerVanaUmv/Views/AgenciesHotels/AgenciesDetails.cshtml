@model RezerVanaUmv.ViewModels.AgencyReservationsViewModel

@{
    ViewData["Title"] = "Ajans Detay";
    Layout = "~/Views/PageViews/UserLayout.cshtml";
}
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.dataTables.min.css" />

<style>
    /* Tabloyu ekrana zorla sığdır */
    #reservationsTable {
        font-size: 0.80rem;
        table-layout: fixed;
        width: 100%;
    }

        #reservationsTable th,
        #reservationsTable td {
            padding: 4px 6px;
            white-space: normal;
            word-wrap: break-word;
        }

            /* Kısa kolonları ortala (puan, durum, işlem) */
            #reservationsTable th:nth-child(9),
            #reservationsTable td:nth-child(9),
            #reservationsTable th:nth-child(11),
            #reservationsTable td:nth-child(11),
            #reservationsTable th:nth-child(12),
            #reservationsTable td:nth-child(12) {
                text-align: center;
            }

                #reservationsTable td:nth-child(12) .btn {
                    margin-bottom: 2px;
                    padding: 2px 6px;
                    font-size: 0.75rem;
                }
</style>

<h1 class="mb-3">@RezerVanaUmv.Resources.Resource.Ajans</h1>
<h4 class="text-muted">@Model.agency.Name</h4>
<hr />

<!-- 🧾 PUAN ÖZETİ -->
<div class="mb-4">
    <h4 class="text-primary mb-3">@Model.agency.Unvan</h4>

    <div class="row g-3">

        <!-- Bonus Points -->
        <div class="col-md-6 col-lg-4">
            <div class="d-flex align-items-center bg-white shadow-sm rounded p-3">
                <div class="me-2 bg-secondary text-white p-3 rounded">
                    <i class="fas fa-plus fa-lg"></i>
                </div>
                <div>
                    <h6 class="mb-1">Bonus Puan</h6>
                    <h4 class="mb-0">@Model.BonusPoints.ToString("N0")</h4>
                </div>
            </div>
        </div>

        <!-- Gained Points -->
        <div class="col-md-6 col-lg-4">
            <div class="d-flex align-items-center bg-white shadow-sm rounded p-3">
                <div class="me-2 bg-success text-white p-3 rounded">
                    <i class="fas fa-arrow-up fa-lg"></i>
                </div>
                <div>
                    <h6 class="mb-1">@RezerVanaUmv.Resources.Resource.Points_Earned</h6>
                    <h4 class="mb-0">@Model.GainedPoints.ToString("N0")</h4>
                </div>
            </div>
        </div>

        <!-- Pending Points -->
        <div class="col-md-6 col-lg-4">
            <div class="d-flex align-items-center bg-white shadow-sm rounded p-3">
                <div class="me-2 bg-info text-white p-3 rounded">
                    <i class="fas fa-clock fa-lg"></i>
                </div>
                <div>
                    <h6 class="mb-1">@RezerVanaUmv.Resources.Resource.Pending_Spent</h6>
                    <h4 class="mb-0">@Model.PendingPoints.ToString("N0")</h4>
                </div>
            </div>
        </div>

        <!-- Spent Points -->
        <div class="col-md-6 col-lg-4">
            <div class="d-flex align-items-center bg-white shadow-sm rounded p-3">
                <div class="me-2 bg-danger text-white p-3 rounded">
                    <i class="fas fa-wallet fa-lg"></i>
                </div>
                <div>
                    <h6 class="mb-1">@RezerVanaUmv.Resources.Resource.Points_Spent</h6>
                    <h4 class="mb-0">@Model.SpentPoints.ToString("N0")</h4>
                </div>
            </div>
        </div>

        <!-- Spent Pending Points -->
        <div class="col-md-6 col-lg-4">
            <div class="d-flex align-items-center bg-white shadow-sm rounded p-3">
                <div class="me-2 bg-warning text-white p-3 rounded">
                    <i class="fas fa-hourglass-half fa-lg"></i>
                </div>
                <div>
                    <h6 class="mb-1">@RezerVanaUmv.Resources.Resource.Pending_Spent </h6>
                    <h4 class="mb-0">@Model.SpentPendingPoints.ToString("N0")</h4>
                </div>
            </div>
        </div>

        <!-- Total Spendable -->
        <div class="col-md-6 col-lg-4">
            <div class="d-flex align-items-center bg-white shadow-sm rounded p-3">
                <div class="me-2 bg-primary text-white p-3 rounded">
                    <i class="fas fa-equals fa-lg"></i>
                </div>
                <div>
                    <h6 class="mb-1">@RezerVanaUmv.Resources.Resource.Points_Spendable</h6>
                    <h4 class="mb-0">@Model.TotalPoints.ToString("N0")</h4>
                </div>
            </div>
        </div>

    </div>
</div>


<!-- 👤 AJANS BİLGİLERİ -->
<div class="row mt-4">
    <div class="col-md-6">
        <h5>👤 @RezerVanaUmv.Resources.Resource.Temel_Bilgiler</h5>
        <table class="table table-sm table-borderless">
            <tr>
                <th style="width: 160px;">@RezerVanaUmv.Resources.Resource.Adı_Soyadı</th>
                <td>@Model.agency.Name</td>
            </tr>
            <tr>
                <th>@RezerVanaUmv.Resources.Resource.EPosta</th>
                <td>@Model.agency.Email</td>
            </tr>
            <tr>
                <th>@RezerVanaUmv.Resources.Resource.Oluşturma_Tarihi</th>
                <td>@Model.agency.CreatedAt?.ToString("dd.MM.yyyy HH:mm")</td>
            </tr>
        </table>
    </div>

    <div class="col-md-6">
        <h5>🏢 @RezerVanaUmv.Resources.Resource.Kurumsal_Bilgiler</h5>
        <table class="table table-sm table-borderless">
            <tr>
                <th style="width: 160px;">Unvan</th>
                <td>@Model.agency.Unvan</td>
            </tr>
            <tr>
                <th> @RezerVanaUmv.Resources.Resource.Ülke</th>
                <td>@Model.agency.Ulke</td>
            </tr>
            <tr>
                <th> @RezerVanaUmv.Resources.Resource.Şehir</th>
                <td>@Model.agency.Sehir</td>
            </tr>
            <tr>
                <th> @RezerVanaUmv.Resources.Resource.Şirket_Telefonu</th>
                <td>@Model.agency.SirketTelAlanKodu @Model.agency.SirketTel</td>
            </tr>
            <tr>
                <th> @RezerVanaUmv.Resources.Resource.Şirket_Adresi</th>
                <td>@Model.agency.SirketAdres</td>
            </tr>
        </table>
    </div>
</div>

<hr class="mt-4" />

<!-- 📋 REZERVASYON LİSTESİ (bir sonraki mesajda dolduracağız) -->
<h4 class="mt-3">📋 @RezerVanaUmv.Resources.Resource.AGENCY_RESERVATIONS</h4>

<table id="reservationsTable" class="table table-striped table-bordered table-sm" style="font-size:12px;">
    <thead class="table-dark">
        <tr>
            <th> @RezerVanaUmv.Resources.Resource.Tarih</th>
            <th>@RezerVanaUmv.Resources.Resource.VOUCHER</th>
            <th>@RezerVanaUmv.Resources.Resource.ADI</th>
            <th>@RezerVanaUmv.Resources.Resource.AGENCY_NAME</th>
            <th> @RezerVanaUmv.Resources.Resource.Ülke</th>
            <th> @RezerVanaUmv.Resources.Resource.Şehir</th>
            <th>@RezerVanaUmv.Resources.Resource.CHECK_IN</th>
            <th>@RezerVanaUmv.Resources.Resource.CHECK_OUT</th>
            <th>@RezerVanaUmv.Resources.Resource.Durum</th>
            <th>@RezerVanaUmv.Resources.Resource.Puan</th>
            <th class="text-center">İşlemler</th>
        </tr>
    </thead>
    <tbody>
            @foreach (var item in Model.Reservations)
            {
            <tr>
                <td>@item.Reservation?.ReservationDate</td>
                <td>@(item.Reservation?.BookingReference ?? "—")</td>
                <td>
                    @if (item.Reservation?.Passengers != null && item.Reservation.Passengers.Any())
                    {
                        @string.Join(", ",
                                 item.Reservation.Passengers
                                 .Select(p => $"{p.FirstName} {p.LastName}")
                                 )
                    }
                    else
                    {
                        <span>—</span>
                    }
                </td>
                <td>@Model.agency.Unvan</td>
                <td>@Model.agency.Ulke</td>
                <td>@Model.agency.Sehir</td>
                <td>@(item.Reservation?.CheckinDate?.ToString("dd.MM.yyyy") ?? "—")</td>
                <td>@(item.Reservation?.CheckoutDate?.ToString("dd.MM.yyyy") ?? "—")</td>

                <td>@(item.Reservation?.Status ?? "—")</td>

                <td>
                        @(
                            item.Reservation?.TotalAmount != null
                            ? String.Format("{0:N2}", item.Reservation.TotalAmount)
                            : "—"
                            )
                </td>
                <td class="text-center">
                   @if (item.Reservation != null)
                   {
                       <a asp-action="EditHarcamalar" asp-route-id="@item.Reservation.Id" class="btn btn-warning btn-sm" style="font-size: 0.75rem;">
                           <i class="fas fa-edit"></i> Düzenle
                       </a>
                   }
                </td>
            </tr>
            }
    </tbody>
</table>


<a asp-action="Index" class="btn btn-secondary mt-3">Listeye Dön</a>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.colVis.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

    <script>
        $(function () {
            $('#reservationsTable').DataTable({
                dom: 'Bfrtip',
                scrollX: true,
                autoWidth: false,
                responsive: true,
                stateSave: true,
                stateDuration: -1,
                stateLoadParams: function (settings, data) {
                    var navigationType = performance.getEntriesByType("navigation")[0].type;
                    if (navigationType !== 'back_forward') {
                        return false;
                    }
                },
                buttons: [
                    'copy', 'excel', 'pdf', 'print'
                ],language: { url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/tr.json' }
            });
        });
    </script>
}